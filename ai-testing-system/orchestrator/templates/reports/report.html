<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Validation Report - {{ report.metadata.test_run_id }}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            line-height: 1.6;
            color: #1a202c;
            background: #f7fafc;
            padding: 40px 20px;
        }
        
        .report-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        /* Header */
        .report-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
        }
        
        .report-header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .report-header .meta-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .report-header .meta-info p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .report-header .meta-info strong {
            display: block;
            font-size: 16px;
            margin-top: 5px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
            margin-top: 10px;
        }
        
        .status-pass { background: #48bb78; }
        .status-fail { background: #f56565; }
        .status-warning { background: #ed8936; }
        
        /* Main Content */
        .report-content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
        }
        
        .section h2 {
            font-size: 24px;
            color: #2d3748;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        /* Executive Summary */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            padding: 24px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-card h3 {
            font-size: 36px;
            color: #667eea;
            margin-bottom: 8px;
        }
        
        .stat-card p {
            font-size: 14px;
            color: #718096;
        }
        
        .stat-card.success h3 { color: #48bb78; }
        .stat-card.failure h3 { color: #f56565; }
        .stat-card.warning h3 { color: #ed8936; }
        
        /* Issues */
        .issue-card {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .issue-card.critical { border-left: 4px solid #f56565; }
        .issue-card.high { border-left: 4px solid #ed8936; }
        .issue-card.medium { border-left: 4px solid #ecc94b; }
        .issue-card.low { border-left: 4px solid #4299e1; }
        
        .issue-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .issue-title {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
        }
        
        .severity-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .severity-critical { background: #f56565; color: white; }
        .severity-high { background: #ed8936; color: white; }
        .severity-medium { background: #ecc94b; color: #2d3748; }
        .severity-low { background: #4299e1; color: white; }
        
        .issue-description {
            margin: 15px 0;
            color: #4a5568;
        }
        
        .consensus-matrix {
            margin: 20px 0;
        }
        
        .consensus-matrix table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .consensus-matrix th,
        .consensus-matrix td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .consensus-matrix th {
            background: #f7fafc;
            font-weight: 600;
            color: #4a5568;
        }
        
        .consensus-check {
            font-size: 18px;
        }
        
        .screenshot-preview {
            margin: 20px 0;
            max-width: 100%;
        }
        
        .screenshot-preview img {
            max-width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        /* Performance Metrics */
        .metrics-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .metrics-table td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metrics-table td:first-child {
            font-weight: 600;
            color: #4a5568;
        }
        
        /* Costs */
        .cost-breakdown {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
        }
        
        .cost-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .cost-item:last-child {
            border-bottom: none;
            font-weight: bold;
            font-size: 18px;
        }
        
        /* Print styles */
        @media print {
            body { padding: 0; background: white; }
            .report-container { box-shadow: none; }
            .issue-card { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="report-container">
        <!-- Report Header -->
        <header class="report-header">
            <h1>QA Validation Report</h1>
            <p>AI-Driven Game Testing System</p>
            
            <span class="status-badge status-{{ report.metadata.status|lower }}">
                {{ report.metadata.status }}
            </span>
            
            <div class="meta-info">
                <div>
                    <p>Game</p>
                    <strong>{{ report.metadata.game_title }}</strong>
                    {% if report.metadata.game_version %}
                    <p style="font-size: 12px; margin-top: 5px;">v{{ report.metadata.game_version }}</p>
                    {% endif %}
                </div>
                <div>
                    <p>Test Run ID</p>
                    <strong>{{ report.metadata.test_run_id }}</strong>
                </div>
                <div>
                    <p>Environment</p>
                    <strong>{{ report.metadata.test_environment }}</strong>
                </div>
                <div>
                    <p>Generated</p>
                    <strong>{{ report.metadata.timestamp_generated_utc|format_datetime }}</strong>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <div class="report-content">
            
            <!-- Executive Summary -->
            <section class="section">
                <h2>Executive Summary</h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>{{ report.summary.total_screenshots }}</h3>
                        <p>Total Screenshots</p>
                    </div>
                    
                    <div class="stat-card success">
                        <h3>{{ report.summary.screenshots_passed }}</h3>
                        <p>Passed</p>
                    </div>
                    
                    <div class="stat-card failure">
                        <h3>{{ report.summary.screenshots_with_issues }}</h3>
                        <p>Issues Found</p>
                    </div>
                    
                    <div class="stat-card {% if report.summary.pass_rate >= 90 %}success{% elif report.summary.pass_rate >= 70 %}warning{% else %}failure{% endif %}">
                        <h3>{{ report.summary.pass_rate|format_percentage }}</h3>
                        <p>Pass Rate</p>
                    </div>
                </div>
                
                <div style="margin-top: 30px;">
                    <h3 style="font-size: 16px; color: #4a5568; margin-bottom: 10px;">Issues by Severity</h3>
                    <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                        {% if report.summary.issues_by_severity.critical > 0 %}
                        <span class="severity-badge severity-critical">Critical: {{ report.summary.issues_by_severity.critical }}</span>
                        {% endif %}
                        {% if report.summary.issues_by_severity.high > 0 %}
                        <span class="severity-badge severity-high">High: {{ report.summary.issues_by_severity.high }}</span>
                        {% endif %}
                        {% if report.summary.issues_by_severity.medium > 0 %}
                        <span class="severity-badge severity-medium">Medium: {{ report.summary.issues_by_severity.medium }}</span>
                        {% endif %}
                        {% if report.summary.issues_by_severity.low > 0 %}
                        <span class="severity-badge severity-low">Low: {{ report.summary.issues_by_severity.low }}</span>
                        {% endif %}
                    </div>
                </div>
            </section>
            
            <!-- Consensus Issues -->
            <section class="section">
                <h2>Consensus Issues ({{ report.consensus_issues|length }})</h2>
                
                {% if report.consensus_issues %}
                    {% for issue in report.consensus_issues %}
                    <div class="issue-card {{ issue.severity }}">
                        <div class="issue-header">
                            <div class="issue-title">{{ issue.title }}</div>
                            <span class="severity-badge severity-{{ issue.severity }}">{{ issue.severity }}</span>
                        </div>
                        
                        <div class="issue-description">
                            <strong>Description:</strong> {{ issue.description }}
                        </div>
                        
                        {% if issue.screenshot_url %}
                        <div class="screenshot-preview">
                            <img src="{{ issue.screenshot_url }}" alt="Screenshot for {{ issue.issue_id }}" />
                        </div>
                        {% endif %}
                        
                        <div class="consensus-matrix">
                            <h4 style="font-size: 14px; color: #4a5568; margin-bottom: 10px;">AI Models Consensus</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Model</th>
                                        <th>Detected</th>
                                        <th>Confidence</th>
                                        <th>Reason</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for analysis in issue.consensus_details %}
                                    <tr>
                                        <td>{{ analysis.model_name }}</td>
                                        <td class="consensus-check">
                                            {% if analysis.detected %}‚úÖ{% else %}‚ùå{% endif %}
                                        </td>
                                        <td>{{ (analysis.confidence * 100)|round|int }}%</td>
                                        <td style="font-size: 13px; color: #718096;">{{ analysis.reason }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                        
                        {% if issue.triage_url %}
                        <div style="margin-top: 15px;">
                            <a href="{{ issue.triage_url }}" style="color: #667eea; text-decoration: none; font-weight: 600;">
                                ‚Üí Triage This Issue
                            </a>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div style="text-align: center; padding: 40px; background: #f7fafc; border-radius: 8px;">
                        <p style="font-size: 18px; color: #48bb78;">üéâ No issues detected!</p>
                        <p style="margin-top: 10px; color: #718096;">All screenshots passed AI analysis.</p>
                    </div>
                {% endif %}
            </section>
            
            <!-- AI Recommendations -->
            {% if report.recommendations %}
            <section class="section">
                <h2>AI Recommendations</h2>
                <div style="background: #fffaf0; border-left: 4px solid #ed8936; padding: 20px; border-radius: 4px;">
                    <p style="color: #2d3748;">{{ report.recommendations }}</p>
                </div>
            </section>
            {% endif %}
            
            <!-- Performance Metrics -->
            <section class="section">
                <h2>Performance Metrics</h2>
                <table class="metrics-table">
                    <tr>
                        <td>Total Processing Time</td>
                        <td>{{ report.performance.total_processing_time_seconds|round(2) }} seconds</td>
                    </tr>
                    <tr>
                        <td>Average Time per Screenshot</td>
                        <td>{{ report.performance.average_time_per_screenshot_seconds|round(2) }} seconds</td>
                    </tr>
                    {% if report.performance.model_latency_gemini_avg %}
                    <tr>
                        <td>Gemini 2.5 Pro Avg Latency</td>
                        <td>{{ report.performance.model_latency_gemini_avg|round(2) }} seconds</td>
                    </tr>
                    {% endif %}
                    {% if report.performance.model_latency_gpt5_avg %}
                    <tr>
                        <td>GPT-5 Avg Latency</td>
                        <td>{{ report.performance.model_latency_gpt5_avg|round(2) }} seconds</td>
                    </tr>
                    {% endif %}
                    {% if report.performance.model_latency_claude_avg %}
                    <tr>
                        <td>Claude Sonnet 4.5 Avg Latency</td>
                        <td>{{ report.performance.model_latency_claude_avg|round(2) }} seconds</td>
                    </tr>
                    {% endif %}
                </table>
            </section>
            
            <!-- Cost Analysis -->
            <section class="section">
                <h2>Cost Analysis</h2>
                <div class="cost-breakdown">
                    <div class="cost-item">
                        <span>Gemini 2.5 Pro ({{ report.costs.gemini_calls }} calls)</span>
                        <span>${{ report.costs.gemini_cost_usd|round(4) }}</span>
                    </div>
                    <div class="cost-item">
                        <span>GPT-5 ({{ report.costs.gpt5_calls }} calls)</span>
                        <span>${{ report.costs.gpt5_cost_usd|round(4) }}</span>
                    </div>
                    <div class="cost-item">
                        <span>Claude Sonnet 4.5 ({{ report.costs.claude_calls }} calls)</span>
                        <span>${{ report.costs.claude_cost_usd|round(4) }}</span>
                    </div>
                    <div class="cost-item">
                        <span>Storage (S3, SQS, Redis)</span>
                        <span>${{ report.costs.storage_cost_usd|round(4) }}</span>
                    </div>
                    <div class="cost-item">
                        <span>Total Cost</span>
                        <span>${{ report.costs.total_cost_usd|round(4) }}</span>
                    </div>
                </div>
            </section>
            
            <!-- Footer -->
            <footer style="margin-top: 60px; padding-top: 20px; border-top: 2px solid #e2e8f0; text-align: center; color: #718096; font-size: 12px;">
                <p>Generated by Body Broker QA Orchestrator</p>
                <p style="margin-top: 5px;">Report ID: {{ report.metadata.report_id }}</p>
                <p style="margin-top: 5px;">AI Models: {{ report.metadata.ai_models|join(', ') }}</p>
                <p style="margin-top: 5px;">Consensus Logic: {{ report.metadata.consensus_logic }}</p>
            </footer>
            
        </div>
    </div>
</body>
</html>

